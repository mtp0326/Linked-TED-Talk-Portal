"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var MiddlewareStack = /** @class */ (function () {
    function MiddlewareStack() {
        this.entries = [];
        this.sorted = true;
    }
    MiddlewareStack.prototype.add = function (middleware, options) {
        if (options === void 0) { options = {}; }
        var _a = options.step, step = _a === void 0 ? "initialize" : _a, _b = options.priority, priority = _b === void 0 ? 0 : _b, tags = options.tags;
        this.sorted = false;
        this.entries.push({
            middleware: middleware,
            priority: priority,
            step: step,
            tags: tags
        });
    };
    MiddlewareStack.prototype.clone = function () {
        var _a;
        var clone = new MiddlewareStack();
        (_a = clone.entries).push.apply(_a, this.entries);
        clone.sorted = this.sorted;
        return clone;
    };
    MiddlewareStack.prototype.concat = function (from) {
        var _a;
        var clone = new MiddlewareStack();
        (_a = clone.entries).push.apply(_a, this.entries.concat(from.entries));
        clone.sorted = false;
        return clone;
    };
    MiddlewareStack.prototype.remove = function (toRemove) {
        var length = this.entries.length;
        if (typeof toRemove === "string") {
            this.removeByTag(toRemove);
        }
        else {
            this.removeByIdentity(toRemove);
        }
        return this.entries.length < length;
    };
    MiddlewareStack.prototype.filter = function (callbackfn) {
        var filtered = new MiddlewareStack();
        for (var _i = 0, _a = this.entries; _i < _a.length; _i++) {
            var entry = _a[_i];
            var options = {
                step: entry.step,
                priority: entry.priority,
                tags: tslib_1.__assign({}, entry.tags)
            };
            if (callbackfn(options)) {
                filtered.entries.push(entry);
            }
        }
        filtered.sorted = this.sorted;
        return filtered;
    };
    MiddlewareStack.prototype.resolve = function (handler, context) {
        if (!this.sorted) {
            this.sort();
        }
        for (var _i = 0, _a = this.entries; _i < _a.length; _i++) {
            var middleware = _a[_i].middleware;
            handler = middleware(handler, context);
        }
        return handler;
    };
    MiddlewareStack.prototype.removeByIdentity = function (toRemove) {
        for (var i = this.entries.length - 1; i >= 0; i--) {
            if (this.entries[i].middleware === toRemove) {
                this.entries.splice(i, 1);
            }
        }
    };
    MiddlewareStack.prototype.removeByTag = function (toRemove) {
        for (var i = this.entries.length - 1; i >= 0; i--) {
            var tags = this.entries[i].tags;
            if (tags && toRemove in tags) {
                this.entries.splice(i, 1);
            }
        }
    };
    MiddlewareStack.prototype.sort = function () {
        this.entries.sort(function (a, b) {
            var stepWeight = stepWeights[a.step] - stepWeights[b.step];
            return stepWeight || a.priority - b.priority;
        });
        this.sorted = true;
    };
    return MiddlewareStack;
}());
exports.MiddlewareStack = MiddlewareStack;
var stepWeights = {
    initialize: 4,
    serialize: 3,
    build: 2,
    finalize: 1
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBK0JBO0lBQUE7UUFLbUIsWUFBTyxHQUFtRCxFQUFFLENBQUM7UUFDdEUsV0FBTSxHQUFZLElBQUksQ0FBQztJQTZIakMsQ0FBQztJQXZHQyw2QkFBRyxHQUFILFVBQ0UsVUFBcUMsRUFDckMsT0FBNEI7UUFBNUIsd0JBQUEsRUFBQSxZQUE0QjtRQUVwQixJQUFBLGlCQUFtQixFQUFuQix3Q0FBbUIsRUFBRSxxQkFBWSxFQUFaLGlDQUFZLEVBQUUsbUJBQUksQ0FBYTtRQUM1RCxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztZQUNoQixVQUFVLFlBQUE7WUFDVixRQUFRLFVBQUE7WUFDUixJQUFJLE1BQUE7WUFDSixJQUFJLE1BQUE7U0FDTCxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsK0JBQUssR0FBTDs7UUFDRSxJQUFNLEtBQUssR0FBRyxJQUFJLGVBQWUsRUFBeUIsQ0FBQztRQUMzRCxDQUFBLEtBQUEsS0FBSyxDQUFDLE9BQU8sQ0FBQSxDQUFDLElBQUksV0FBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQ3BDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMzQixPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxnQ0FBTSxHQUFOLFVBQ0UsSUFBb0Q7O1FBRXBELElBQU0sS0FBSyxHQUFHLElBQUksZUFBZSxFQUFpQyxDQUFDO1FBQ25FLENBQUEsS0FBQSxLQUFLLENBQUMsT0FBTyxDQUFBLENBQUMsSUFBSSxXQUFLLElBQUksQ0FBQyxPQUFlLFFBQUssSUFBSSxDQUFDLE9BQU8sR0FBRTtRQUM5RCxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUNyQixPQUFPLEtBQUssQ0FBQztJQUNmLENB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O1FBQ0gsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUNILHNCQUFDO0FBQUQsQ0FBQyxBQW5JRCxJQW1JQztBQW5JWSwwQ0FBZTtBQXFJNUIsSUFBTSxXQUFXLEdBQUc7SUFDbEIsVUFBVSxFQUFFLENBQUM7SUFDYixTQUFTLEVBQUUsQ0FBQztJQUNaLEtBQUssRUFBRSxDQUFDO0lBQ1IsUUFBUSxFQUFFLENBQUM7Q0FDWixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQnVpbGRIYW5kbGVyT3B0aW9ucyxcbiAgRmluYWxpemVIYW5kbGVyLFxuICBGaW5hbGl6ZUhhbmRsZXJPcHRpb25zLFxuICBGaW5hbGl6ZU1pZGRsZXdhcmUsXG4gIEhhbmRsZXIsXG4gIEhhbmRsZXJFeGVjdXRpb25Db250ZXh0LFxuICBIYW5kbGVyT3B0aW9ucyxcbiAgTWlkZGxld2FyZSxcbiAgTWlkZGxld2FyZVN0YWNrIGFzIElNaWRkbGV3YXJlU3RhY2ssXG4gIFNlcmlhbGl6ZUhhbmRsZXJPcHRpb25zLFxuICBTdGVwXG59IGZyb20gXCJAYXdzLXNkay90eXBlc1wiO1xuXG5pbnRlcmZhY2UgSGFuZGxlckxpc3RFbnRyeTxcbiAgSW5wdXQgZXh0ZW5kcyBvYmplY3QsXG4gIE91dHB1dCBleHRlbmRzIG9iamVjdCxcbiAgU3RyZWFtXG4+IHtcbiAgc3RlcDogU3RlcDtcbiAgcHJpb3JpdHk6IG51bWJlcjtcbiAgbWlkZGxld2FyZTogTWlkZGxld2FyZTxJbnB1dCwgT3V0cHV0PjtcbiAgdGFncz86IHsgW3RhZzogc3RyaW5nXTogYW55IH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWlkZGxld2FyZVN0YWNrPFxuICBJbnB1dCBleHRlbmRzIG9iamVjdCxcbiAgT3V0cHV0IGV4dGVuZHMgb2JqZWN0LFxuICBTdHJlYW0gPSBVaW50OEFycmF5XG4+IGV4dGVuZHMgSU1pZGRsZXdhcmVTdGFjazxJbnB1dCwgT3V0cHV0LCBTdHJlYW0+IHt9XG5cbmV4cG9ydCBjbGFzcyBNaWRkbGV3YXJlU3RhY2s8XG4gIElucHV0IGV4dGVuZHMgb2JqZWN0LFxuICBPdXRwdXQgZXh0ZW5kcyBvYmplY3QsXG4gIFN0cmVhbSA9IFVpbnQ4QXJyYXlcbj4ge1xuICBwcml2YXRlIHJlYWRvbmx5IGVudHJpZXM6IEFycmF5PEhhbmRsZXJMaXN0RW50cnk8SW5wdXQsIE91dHB1dCwgU3RyZWFtPj4gPSBbXTtcbiAgcHJpdmF0ZSBzb3J0ZWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIGFkZChcbiAgICBtaWRkbGV3YXJlOiBNaWRkbGV3YXJlPElucHV0LCBPdXRwdXQ+LFxuICAgIG9wdGlvbnM/OiBIYW5kbGVyT3B0aW9ucyAmIHsgc3RlcD86IFwiaW5pdGlhbGl6ZVwiIH1cbiAgKTogdm9pZDtcblxuICBhZGQoXG4gICAgbWlkZGxld2FyZTogTWlkZGxld2FyZTxJbnB1dCwgT3V0cHV0PixcbiAgICBvcHRpb25zOiBTZXJpYWxpemVIYW5kbGVyT3B0aW9uc1xuICApOiB2b2lkO1xuXG4gIGFkZChcbiAgICBtaWRkbGV3YXJlOiBGaW5hbGl6ZU1pZGRsZXdhcmU8SW5wdXQsIE91dHB1dCwgU3RyZWFtPixcbiAgICBvcHRpb25zOiBCdWlsZEhhbmRsZXJPcHRpb25zXG4gICk6IHZvaWQ7XG5cbiAgYWRkKFxuICAgIG1pZGRsZXdhcmU6IEZpbmFsaXplTWlkZGxld2FyZTxJbnB1dCwgT3V0cHV0LCBTdHJlYW0+LFxuICAgIG9wdGlvbnM6IEZpbmFsaXplSGFuZGxlck9wdGlvbnNcbiAgKTogdm9pZDtcblxuICBhZGQoXG4gICAgbWlkZGxld2FyZTogTWlkZGxld2FyZTxJbnB1dCwgT3V0cHV0PixcbiAgICBvcHRpb25zOiBIYW5kbGVyT3B0aW9ucyA9IHt9XG4gICk6IHZvaWQge1xuICAgIGNvbnN0IHsgc3RlcCA9IFwiaW5pdGlhbGl6ZVwiLCBwcmlvcml0eSA9IDAsIHRhZ3MgfSA9IG9wdGlvbnM7XG4gICAgdGhpcy5zb3J0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmVudHJpZXMucHVzaCh7XG4gICAgICBtaWRkbGV3YXJlLFxuICAgICAgcHJpb3JpdHksXG4gICAgICBzdGVwLFxuICAgICAgdGFnc1xuICAgIH0pO1xuICB9XG5cbiAgY2xvbmUoKTogSU1pZGRsZXdhcmVTdGFjazxJbnB1dCwgT3V0cHV0LCBTdHJlYW0+IHtcbiAgICBjb25zdCBjbG9uZSA9IG5ldyBNaWRkbGV3YXJlU3RhY2s8SW5wdXQsIE91dHB1dCwgU3RyZWFtPigpO1xuICAgIGNsb25lLmVudHJpZXMucHVzaCguLi50aGlzLmVudHJpZXMpO1xuICAgIGNsb25lLnNvcnRlZCA9IHRoaXMuc29ydGVkO1xuICAgIHJldHVybiBjbG9uZTtcbiAgfVxuXG4gIGNvbmNhdDxJbnB1dFR5cGUgZXh0ZW5kcyBJbnB1dCwgT3V0cHV0VHlwZSBleHRlbmRzIE91dHB1dD4oXG4gICAgZnJvbTogTWlkZGxld2FyZVN0YWNrPElucHV0VHlwZSwgT3V0cHV0VHlwZSwgU3RyZWFtPlxuICApOiBNaWRkbGV3YXJlU3RhY2s8SW5wdXRUeXBlLCBPdXRwdXRUeXBlLCBTdHJlYW0+IHtcbiAgICBjb25zdCBjbG9uZSA9IG5ldyBNaWRkbGV3YXJlU3RhY2s8SW5wdXRUeXBlLCBPdXRwdXRUeXBlLCBTdHJlYW0+KCk7XG4gICAgY2xvbmUuZW50cmllcy5wdXNoKC4uLih0aGlzLmVudHJpZXMgYXMgYW55KSwgLi4uZnJvbS5lbnRyaWVzKTtcbiAgICBjbG9uZS5zb3J0ZWQgPSBmYWxzZTtcbiAgICByZXR1cm4gY2xvbmU7XG4gIH1cblxuICByZW1vdmUodG9SZW1vdmU6IE1pZGRsZXdhcmU8SW5wdXQsIE91dHB1dD4gfCBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCB7IGxlbmd0aCB9ID0gdGhpcy5lbnRyaWVzO1xuICAgIGlmICh0eXBlb2YgdG9SZW1vdmUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMucmVtb3ZlQnlUYWcodG9SZW1vdmUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbW92ZUJ5SWRlbnRpdHkodG9SZW1vdmUpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmVudHJpZXMubGVuZ3RoIDwgbGVuZ3RoO1xuICB9XG5cbiAgZmlsdGVyKFxuICAgIGNhbGxiYWNrZm46IChoYW5kbGVyT3B0aW9uczogSGFuZGxlck9wdGlvbnMpID0+IGJvb2xlYW5cbiAgKTogTWlkZGxld2FyZVN0YWNrPElucHV0LCBPdXRwdXQsIFN0cmVhbT4ge1xuICAgIGNvbnN0IGZpbHRlcmVkID0gbmV3IE1pZGRsZXdhcmVTdGFjazxJbnB1dCwgT3V0cHV0LCBTdHJlYW0+KCk7XG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzLmVudHJpZXMpIHtcbiAgICAgIGNvbnN0IG9wdGlvbnM6IEhhbmRsZXJPcHRpb25zID0ge1xuICAgICAgICBzdGVwOiBlbnRyeS5zdGVwLFxuICAgICAgICBwcmlvcml0eTogZW50cnkucHJpb3JpdHksXG4gICAgICAgIHRhZ3M6IHtcbiAgICAgICAgICAuLi5lbnRyeS50YWdzXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBpZiAoY2FsbGJhY2tmbihvcHRpb25zKSkge1xuICAgICAgICBmaWx0ZXJlZC5lbnRyaWVzLnB1c2goZW50cnkpO1xuICAgICAgfVxuICAgIH1cbiAgICBmaWx0ZXJlZC5zb3J0ZWQgPSB0aGlzLnNvcnRlZDtcbiAgICByZXR1cm4gZmlsdGVyZWQ7XG4gIH1cblxuICByZXNvbHZlPElucHV0VHlwZSBleHRlbmRzIElucHV0LCBPdXRwdXRUeXBlIGV4dGVuZHMgT3V0cHV0PihcbiAgICBoYW5kbGVyOiBGaW5hbGl6ZUhhbmRsZXI8SW5wdXRUeXBlLCBPdXRwdXRUeXBlLCBTdHJlYW0+LFxuICAgIGNvbnRleHQ6IEhhbmRsZXJFeGVjdXRpb25Db250ZXh0XG4gICk6IEhhbmRsZXI8SW5wdXRUeXBlLCBPdXRwdXRUeXBlPiB7XG4gICAgaWYgKCF0aGlzLnNvcnRlZCkge1xuICAgICAgdGhpcy5zb3J0KCk7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCB7IG1pZGRsZXdhcmUgfSBvZiB0aGlzLmVudHJpZXMpIHtcbiAgICAgIGhhbmRsZXIgPSBtaWRkbGV3YXJlKFxuICAgICAgICBoYW5kbGVyIGFzIEhhbmRsZXI8SW5wdXQsIE91dHB1dFR5cGU+LFxuICAgICAgICBjb250ZXh0XG4gICAgICApIGFzIGFueTtcbiAgICB9XG5cbiAgICByZXR1cm4gaGFuZGxlciBhcyBIYW5kbGVyPElucHV0VHlwZSwgT3V0cHV0VHlwZT47XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUJ5SWRlbnRpdHkodG9SZW1vdmU6IE1pZGRsZXdhcmU8SW5wdXQsIE91dHB1dD4pIHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5lbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBpZiAodGhpcy5lbnRyaWVzW2ldLm1pZGRsZXdhcmUgPT09IHRvUmVtb3ZlKSB7XG4gICAgICAgIHRoaXMuZW50cmllcy5zcGxpY2UoaSwgMSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVCeVRhZyh0b1JlbW92ZTogc3RyaW5nKSB7XG4gICAgZm9yIChsZXQgaSA9IHRoaXMuZW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgeyB0YWdzIH0gPSB0aGlzLmVudHJpZXNbaV07XG4gICAgICBpZiAodGFncyAmJiB0b1JlbW92ZSBpbiB0YWdzKSB7XG4gICAgICAgIHRoaXMuZW50cmllcy5zcGxpY2UoaSwgMSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzb3J0KCk6IHZvaWQge1xuICAgIHRoaXMuZW50cmllcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBjb25zdCBzdGVwV2VpZ2h0ID0gc3RlcFdlaWdodHNbYS5zdGVwXSAtIHN0ZXBXZWlnaHRzW2Iuc3RlcF07XG4gICAgICByZXR1cm4gc3RlcFdlaWdodCB8fCBhLnByaW9yaXR5IC0gYi5wcmlvcml0eTtcbiAgICB9KTtcbiAgICB0aGlzLnNvcnRlZCA9IHRydWU7XG4gIH1cbn1cblxuY29uc3Qgc3RlcFdlaWdodHMgPSB7XG4gIGluaXRpYWxpemU6IDQsXG4gIHNlcmlhbGl6ZTogMyxcbiAgYnVpbGQ6IDIsXG4gIGZpbmFsaXplOiAxXG59O1xuIl19